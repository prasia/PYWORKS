<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>PYWORKS Post Page</title>
    <!--Link to CSS-->
    <link rel="stylesheet" href="./css/style.css">
    <link rel="icon" href="./images/heroimg.png">
    <!--Link to Boxicons-->
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel = "stylesheet">

    
  </head>
  <body>
    <header class="shadow">
        <div class="nav container">
            <a href="./main-page.html" class="logo">PY<span>WORKS.</span></a>
            <!-- Add other header elements as needed -->
            <a href="./login.html" class="login" id="login">Login</a>
            <!-- <a href="./user-profile.html" id="profile"><i class='bx bxs-user-plus'></i></a> -->
        </div>
    </header>
    <script>
        // Use JavaScript to load and insert the shared header

            // function checkLogin(){

            // }
        
            // var userLoggedIn = localStorage.getItem("userLoggedIn");

            // const loginButton = document.getElementById('login');
            // const profileLink = document.getElementById('profile');

            // if (userLoggedIn){
            //     loginButton.innerHTML = "View Profile";
            //     loginButton.href = './user-profile.html'
            // }
            // else{
            //     //profile
            // }
    </script>
    <!--Post Content-->
    <section class="post-header">
        <div class="header-content post-container">
            <!-- Back to Home -->
            <a href="./main-page.html" class="back-home">Back Home</a>
            <!-- Title -->
            <h1 class="header-title" id="header-title">Loading...</h1>
            <!-- Post Image -->
            <img src="" alt = "Post Image" class="header-img">
        </div>
    </section>


    <!--Posts-->
    <!-- <section class="post-content post-container">
        <h2 class="sub-heading">Project Description</h2>
        <p class = "post-text">Lorem ipsum dolor sit amet, consectetur adipisicing elit. Totam, culpa debitis alias quibusdam non qui ratione ducimus corrupti molestias quae blanditiis corporis, praesentium sequi ab distinctio accusantium aspernatur laborum maxime.</p>
        <p class = "post-text">Lorem ipsum dolor sit amet, consectetur adipisicing elit. Totam, culpa debitis alias quibusdam non qui ratione ducimus corrupti molestias quae blanditiis corporis, praesentium sequi ab distinctio accusantium aspernatur laborum maxime.</p>
        <h2 class="sub-heading">Project Description</h2>
        <p class = "post-text">Lorem ipsum dolor sit amet, consectetur adipisicing elit. Totam, culpa debitis alias quibusdam non qui ratione ducimus corrupti molestias quae blanditiis corporis, praesentium sequi ab distinctio accusantium aspernatur laborum maxime.</p>
        <p class = "post-text">Lorem ipsum dolor  sit amet, consectetur adipisicing elit. Totam, culpa debitis alias quibusdam non qui ratione ducimus corrupti molestias quae blanditiis corporis, praesentium sequi ab distinctio accusantium aspernatur laborum maxime.</p>
        <p class = "post-text">Lorem ipsum dolor  sit amet, consectetur adipisicing elit. Totam, culpa debitis alias quibusdam non qui ratione ducimus corrupti molestias quae blanditiis corporis, praesentium sequi ab distinctio accusantium aspernatur laborum maxime.</p>
    </section> -->
    <section class="post-content post-container" id="post-content">
        <!-- <p class = "post-text"> Contact: </p>
        <p class = "post-text"> Hours: </p>
        <p class = "post-text"> City:</p> -->
        <p class="add-info post-contact">Contact: </p>
        <p class="add-info post-hours">Hours: </p>
        <p class="add-info post-location">Location: </p>
        <p class="add-info post-dates">Date(s): </p>
        <p class="add-info post-spots">Spots: </p>
        <p class = "post-text">Lorem ipsum dolor sit amet, consectetur adipisicing elit. Totam, culpa debitis alias quibusdam non qui ratione ducimus corrupti molestias quae blanditiis corporis, praesentium sequi ab distinctio accusantium aspernatur laborum maxime.</p>
        <!-- Dynamic content will be added here using JavaScript -->
    </section>

    <div class="apply-button-container">
        <a id="applyButton" href="#" target="_self">Apply Now!</a>
    </div>

    <div class="open-links-container">
    <a id="openLinksButton" href="#">View Other Applicants!</a>
    </div>

    </div>
    
    <!-- Share -->
    <!-- <div class="share post-container">
        <span class="share-title">Share this article</span>
        <div class = "social">
            <a href="#"><i class = "bx bxl-instagram"> </i></a>
            <a href="#"><i class = "bx bxl-facebook"></i></a>
            <a href="#"><i class = "bx bxl-twitter"></i></a>
            <a href="#"><i class = "bx bxl-tiktok"></i></a>
        </div>
    </div> -->
    <!--Footer-->
    <div class="footer container">
        <p>PYWORKS</p>
        <div class = "social">
            <!-- <a href="#"><i class = "bx bxl-instagram"></a> -->
            <a href="#"><i class = "bx bxl-instagram"> </i></a>
            <a href="#"><i class = "bx bxl-facebook"></i></a>
            <a href="#"><i class = "bx bxl-twitter"></i></a>
            <a href="#"><i class = "bx bxl-tiktok"></i></a>
        </div>
    </div>
    <script type = "module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-analytics.js";
            // TODO: Add SDKs for Firebase products that you want to use
            // https://firebase.google.com/docs/web/setup#available-libraries

            // Your web app's Firebase configuration
            // For Firebase JS SDK v7.20.0 and later, measurementId is optional
            const firebaseConfig = {
                apiKey: "AIzaSyAacuiuUfx9xPozqMnx2gjVhvlLrKDW8U8",
                authDomain: "pyz-test.firebaseapp.com",
                databaseURL: "https://pyz-test-default-rtdb.firebaseio.com",
                projectId: "pyz-test",
                storageBucket: "pyz-test.appspot.com",
                messagingSenderId: "1002244320159",
                appId: "1:1002244320159:web:e30ed55eb549fef3fc2baa",
                measurementId: "G-RDP6P39C09"
            };

            // Initialize Firebase
            const app = initializeApp(firebaseConfig);
            const analytics = getAnalytics(app);
       
    
        import {getDatabase, ref, get, set, child, update, remove, onValue} from "https://www.gstatic.com/firebasejs/10.5.0/firebase-database.js";
        import {onAuthStateChanged, getAuth} from "https://www.gstatic.com/firebasejs/10.5.0/firebase-auth.js";
            //Copy and Paste the URL from near the top of the CDN you pasted in from firebase
            // (the one where you imported "initializeApp" from),
            //but change "firebase-app" to "firebase-database"
        // Use the window.location or another method to extract the post ID from the URL
        // Example:
        const urlParams = new URLSearchParams(window.location.search);
        const postId = urlParams.get('id');
        console.log(postId)
        const auth = getAuth();

        // const currentUrl = window.location.href;
        // // const postId = currentUrl.get('id');
        // console.log(currentUrl);
        // console.log(postId);

        // Reference to your Firebase database
        const db = getDatabase();
        const dbPosts = ref(db, "posts/" + postId); // Post data is structured under "posts"

        // Select elements by their IDs
        const postTitleElement = document.querySelector('#header-title');
        const postDescriptionElement = document.querySelector('.post-text');
        // const postDateElement = document.querySelector('#post-date');
        const postImageElement = document.querySelector('.header-img');
        const postContactElement = document.querySelector('.post-contact');
        const postHoursElement = document.querySelector('.post-hours');
        const postLocationElement = document.querySelector('.post-location');
        const postDateElement = document.querySelector('.post-dates');
        const postSpotsElement = document.querySelector('.post-spots');
        const postApplyButton = document.querySelector('#applyButton');
        const applicantsContainer = document.querySelector('.applicant-container');

        const loginButton = document.querySelector('.login');

        //Make a list of all the applicant profiles
        function getApplicantProfiles(applicantList){
            const prefix = "user-profile.html?id=";
            const profiles = [];
            for (var i = 0; i < applicantList.length; i++){
                // console.log(applicantList[i]);
                profiles.push(prefix + applicantList[i]);
            }
            return profiles;
        }
        
         // Fetch and display the post data
        onValue(dbPosts, (snapshot) => {
            const postData = snapshot.val();
            if (postData) {
                postTitleElement.innerHTML = postData.Title;
                postDescriptionElement.textContent = postData.Description;
                // postDescriptionElement.innerHTML = postData.Description;
                // // postDateElement.innerHTML = postData.Date;
                // postContactElement.innerHTML = postData.Contact;
                postImageElement.src = postData.Img; // Set the image source
                postContactElement.innerHTML += postData.Contact;
                postHoursElement.innerHTML += postData.Hours;
                postLocationElement.innerHTML += postData.Location;
                postDateElement.innerHTML += postData.Date;
                postSpotsElement.innerHTML += postData.Spots;
                var applicants = getApplicantProfiles(postData.Applicants);

                document.getElementById("openLinksButton").addEventListener("click", function () {
                // Define an array of URLs you want to open

                // Open each link in a new tab or window
                applicants.forEach(function (url) {
                    window.open(url, "_blank");
                });
            });

                // postApplyButton.href = postData.ApplyURL;
            } else {
                console.log('Post not found or error loading data.');
            }
        });
        onAuthStateChanged(auth, (user) => {
            if (user){ //Only if the user is signed in 
                const userUid = user.uid;
                loginButton.innerHTML = "View Profile";
                loginButton.href = loginButton.href = './user-profile.html?id='+ user.uid;
                // var url = window.location.href;
                // console.log(url)
                // // url = "/login.html?loggedIn=true";
                // window.location.replace(url);

                // Save the "Skills" value under the user's node
                postApplyButton.onclick = function() {
                   
                if (!dbPosts.Applicants || !Array.isArray(dbPosts.Applicants)) {
                    dbPosts.Applicants = [userUid]; // Initialize the 'Applicants' array
                } else {
                    dbPosts.Applicants.push(userUid); // Add the user ID
                }

                const updatedData = {
                    Applicants: dbPosts.Applicants
                };

                update(dbPosts, updatedData);
                alert("Application sent succesfully!");
            };

            } else{ //If user is not signed in
                postApplyButton.onclick = function() {
                    alert("You must be signed in to apply for this job!");
                };

            }
        })
    </script>

    <!-- <script src="login.js"></script> -->

    <!--JQuery Link-->
    <!-- <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4=" crossorigin="anonymous"></script> -->
    <!--JS Link-->
	<!-- <script src="main.js"></script> -->
  </body>
</html>